package main

import (
    "fmt"
    "net/http"
    "os"
    "os/signal"
    "syscall"
    "time"

    "github.com/gin-gonic/gin"
    "go.uber.org/zap"
)

func main() {
    logger, _ := zap.NewProduction()
    defer logger.Sync()

    gin.SetMode(gin.DebugMode)  // Activa modo debug

    router := gin.Default()

    // Ruta dummy de prueba fuera de grupo
    router.POST("/api/v1/trades/dummy", func(c *gin.Context) {
        c.JSON(http.StatusOK, gin.H{"message": "Dummy route works"})
    })

    srv := &http.Server{
        Addr:    ":8080",
        Handler: router,
    }

    go func() {
        sigint := make(chan os.Signal, 1)
        signal.Notify(sigint, syscall.SIGINT, syscall.SIGTERM)
        <-sigint

        ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
        defer cancel()

        if err := srv.Shutdown(ctx); err != nil {
            logger.Error("server forced to shutdown", zap.Error(err))
        }
    }()

    logger.Info(fmt.Sprintf("Starting server on %s", srv.Addr))
    if err := srv.ListenAndServe(); err != nil && err != http.ErrServerClosed {
        logger.Fatal("listen error", zap.Error(err))
    }
}